<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css" integrity="sha384-
ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
          crossorigin="anonymous">
    <!-- Custom styles for this template -->
    <link href="/css/jumbotron-narrow.css" rel="stylesheet">
    <title>HealthCare - Coping</title>
    <meta charset="UTF-8">
</head>
<body>
<div id="map" style="width:100%;height:500px;"></div>
<script type="text/javascript"
        src="//dapi.kakao.com/v2/maps/sdk.js?appkey=326a73fe3d4e94b0132a2dc8188b7352&libraries=services,clusterer,drawing"></script>
<script th:inline="javascript">
    var mapContainer = document.getElementById('map'), // 지도를 표시할 div
        mapOption = {
            center: new kakao.maps.LatLng(37.514575, 127.0495556), // 지도의 중심좌표
            level: 10 // 지도의 확대 레벨
        };

    // 지도를 생성합니다
    var map = new kakao.maps.Map(mapContainer, mapOption);

    // 주소-좌표 변환 객체를 생성합니다
    var geocoder = new kakao.maps.services.Geocoder();

    var titleList = [[${result}]];

    // 주소로 좌표를 검색하는 함수 정의
    function searchAddressAndCreateMarker(index) {
        geocoder.addressSearch(titleList[index].znCdNm + " " + titleList[index].lowrnkZnCdNm, function (result, status) {
            // 정상적으로 검색이 완료됐으면
            if (status === kakao.maps.services.Status.OK) {
                var coords = new kakao.maps.LatLng(result[0].y, result[0].x);
                // 결과값으로 받은 위치를 마커로 표시합니다
                var marker = new kakao.maps.Marker({
                    map: map,
                    position: coords
                });
                map.setCenter(coords);
                // 마커를 지도에 표시합니다.
                marker.setMap(map);

                // 마커를 클릭했을 때 마커 위에 표시할 인포윈도우를 생성합니다
                var iwContent = '<div style="padding:5px;">' + titleList[index].cnt + ' 건</div>',
                    iwRemoveable = true;

                // 인포윈도우를 생성합니다
                var infowindow = new kakao.maps.InfoWindow({
                    content: iwContent,
                    removable: iwRemoveable
                });

                // 마커 위에 인포윈도우를 표시합니다
                infowindow.open(map, marker);
            }
        });
    }

    for (var i = 0; i < titleList.length; i++) {
        // console.log("i >>>>>>>>>>>> " + i);
        searchAddressAndCreateMarker(i);
    }
</script>
<div class="container text-center">
    <!--        <p th:text="${result}"/>-->
    <form th:action="@{/api}" method="post">
        <label>
            <select class="form-select" th:name="znCd">
                <option selected th:value="11">지역 선택</option>
                <option th:value="11">서울</option>
                <option th:value="26">부산</option>
                <option th:value="27">대구</option>
                <option th:value="28">인천</option>
                <option th:value="29">광주</option>
                <option th:value="30">대전</option>
            </select>
        </label>
        <label>
            <select class="form-select" th:name="dissCd">
                <option selected th:value="1">예상질병 선택</option>
                <option th:value="1">감기</option>
                <option th:value="2">눈병</option>
                <option th:value="3">식중독</option>
                <option th:value="4">피부염</option>
            </select>
        </label>
        <button class="btn btn-outline-primary" type="submit">조회</button>
    </form>
    <table class="table">
        <thead>
        <tr>
            <th scope="col">예측일자</th>
            <th scope="col">지역명</th>
            <th scope="col">하위지역명</th>
            <th scope="col">질병명</th>
            <th scope="col">질병 예측위험도</th>
<!--            <th scope="col">질병 예측진료건수</th>-->
<!--            <th scope="col">질병 위험도 지침</th>-->
        </tr>
        </thead>
        <tbody>
        <tr th:each="diseaseInfoList : ${result}">
            <!-- 문자열을 LocalDate로 변환하고 원하는 형식으로 포맷팅 -->
            <td th:text="${#temporals.format(T(java.time.LocalDate).parse(diseaseInfoList.dt, T(java.time.format.DateTimeFormatter).ofPattern('yyyyMMdd')), 'yyyy-MM-dd')}"></td>
            <td th:text="${diseaseInfoList.znCdNm}"></td>
            <td th:text="${diseaseInfoList.lowrnkZnCdNm}"></td>
            <td> <a th:text="${diseaseInfoList.dissCdNm}" href=""></a></td>
            <td th:text="${diseaseInfoList.riskNm}"></td>
<!--            <td th:text="${diseaseInfoList.cnt}"></td>-->
<!--            <td th:text="${diseaseInfoList.dissRiskXpln}"></td>-->
        </tr>
        </tbody>
    </table>
</div>
</body>
</html>